<!DOCTYPE html>
<HTML>
  <head>
    <title>
        Yelpington - Your Source For Restaurants in Burlington!
    </title>
    <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
    integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
    integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
    crossorigin=""></script>
    <style>
      body{
        background-color: antiquewhite;
        padding: none;
        margin: 0px !important;
        font-family: 'Varela Round', sans-serif;
      }
      a{
        text-decoration: none;
        color:black;
      }
      h1{
        margin: 0px;
      }
      h3 {
        margin: 0px 10px;
      }
      h5{
        margin-top: 5px;
        margin-bottom: 0px;
      }
      header{
        padding: 10px;
        background: linear-gradient(0deg, #ffd900, white);
        display: flex;
        justify-content: space-between;
        align-items: center
      }
      .hide-me {
        display: none;
      }
      .menuItem:hover a{
        color:blue;
      }
      section{
        height: 100%;
        background-color: antiquewhite;
        padding: 20px;
        display: flex;
        justify-content: space-around;
      }
      #mainMap{
        border: 2px solid lightgray;
        border-radius: 10%;
        height:400px;
        width: 400px;
        margin: 20px;
      }
      #reviewContainer{
        border: 2px solid lightgray;
        border-radius: 10%;
        padding: 10px;
        max-width: 50%;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>
          <a href='/'>
        Yelpington!
        </a>
      </h1>
      <h3>
          Your Source For Restaruants in Burlington!
      </h3>
    </header>
    <section>
      <ul id ='mainMenu'>
        <h2>Restaurants</h2>
        <!-- <li class= 'menuItem'><a href='ahli-babas-kabob-shop'>Ahli Baba's Kabob Shop
        </a></li>
        <li class= 'menuItem'><a href='asiana-noodle-house'>Asiana Noodle House
        </a></li>
        <li class= 'menuItem'><a href='august-first'>August First
        </a></li>
        <li class= 'menuItem'><a href='church-street-tavern'>Church Street Tavern
        </a></li>
        <li class= 'menuItem'><a href='city-market'>City Market
        </a></li>
        <li class= 'menuItem'><a href='mr-mikes'>Mr. Mike's
        </a></li>
        <li class= 'menuItem'><a href='new-moon'>New Moon
        </a></li> -->
      </ul>
      
      <div id="mainMap"></div>
      <div id="reviewContainer"></div>
    </section>
    <script></script>
    <script>
      var mymap = L.map('mainMap').setView([44.4758492, -73.2137881], 15);
      
      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox.streets',
        accessToken: 'sk.eyJ1IjoiY2lnbml0ZSIsImEiOiJjamphM3RocmEzNzBhM3FwZ3poZ2swdGwzIn0.bH6kosn1WPt7jvjuj_ANag'
      }).addTo(mymap);
      
    function makeMarkers(){

    }
      var ahliMarker = L.marker([44.4756659, -73.2130705]).addTo(mymap);
      var asianaMarker = L.marker([44.4779575, -73.212330]).addTo(mymap);
      var augustMarker = L.marker([44.475417, -73.217246]).addTo(mymap);
      var churchStreetTavernMarker = L.marker([44.477475, -73.212735]).addTo(mymap);
      var cityMarker = L.marker([44.478072, -73.210655]).addTo(mymap);
      var mrMikesMarker = L.marker([44.476154, -73.211225]).addTo(mymap);
      var nMoonMarker = L.marker([44.479603, -73.212138]).addTo(mymap);
      
  
      ahliMarker.on('click', function(){
        window.location.href = 'ahli-babas-kabob-shop';
      } ).bindPopup("Ahli Baba's Kabob Shop").on('mouseover',function(){
        ahliMarker.openPopup()
      }).on('mouseout', function(){
        ahliMarker.closePopup()
      })
      asianaMarker.on('click', function(){
        window.location.href = 'asiana-noodle-house';
      } ).bindPopup("Asiana Noodle House").on('mouseover',function(){
        asianaMarker.openPopup()
      }).on('mouseout', function(){
        asianaMarker.closePopup()
      })
      augustMarker.on('click', function(){
        window.location.href = 'august-first';
      } ).bindPopup("August First").on('mouseover',function(){
        augustMarker.openPopup()
      }).on('mouseout', function(){
        augustMarker.closePopup()
      })
      churchStreetTavernMarker.on('click', function(){
        window.location.href = 'church-street-tavern';
      } ).bindPopup("Church Street Tavern").on('mouseover',function(){
        churchStreetTavernMarker.openPopup()
      }).on('mouseout', function(){
        churchStreetTavernMarker.closePopup()
      })
      cityMarker.on('click', function(){
        window.location.href = 'city-market';
      } ).bindPopup("City Market").on('mouseover',function(){
        cityMarker.openPopup()
      }).on('mouseout', function(){
        cityMarker.closePopup()
      })
      mrMikesMarker.on('click', function(){
        window.location.href = 'mr-mikes';
      } ).bindPopup("Mr. Mike's Pizza").on('mouseover',function(){
        mrMikesMarker.openPopup()
      }).on('mouseout', function(){
        mrMikesMarker.closePopup()
      })
      nMoonMarker.on('click', function(){
        window.location.href = 'new-moon';
      } ).bindPopup("New Moon Cafe").on('mouseover',function(){
        nMoonMarker.openPopup()
      }).on('mouseout', function(){
        nMoonMarker.closePopup()
      })
      
      function makeMap(lat, lon) {
        mymap.setView([lat, lon], 19);
      }
      
      let name = document.location.pathname.slice(1);
      
      if (!name) {
        reviewContainer = document.getElementById('reviewContainer')
        reviewContainer.classList.add('hide-me')
        fetch('all.json')
        .then(function(response) {
          console.log(response)
          return response.json()
        })
        .then(function(restaurantList){
          let mainMenu = document.getElementById('mainMenu')
          for (restaurantJson of restaurantList){
            restaurantName = ''
            fetch(restaurantJson+ '.json')
            .then(function(response){
              console.log(response)
              return response.json()
            })
            .then(function(restaurant){
              console.log(restaurant)
              restaurantName = restaurant.name
              mainMenu.innerHTML+= "<li class= 'menuItem'><a href=" + restaurantJson+">" + restaurantName + "</a></li>"
            })
            .catch(function(error){
              console.log('could not populate menu item for ' + restaurantJson + '.' + error)
            })
          }
        })
        console.log("no place name specfied");
      } else {
        mainMenu = document.getElementById('mainMenu')
        mainMenu.classList.add('hide-me')
        fetch(name + '.json')
        .then(function(response) {
          return response.json();
        })
        .then(function(restaurant) {
          fillBody(restaurant)
          if (restaurant.latlon) {
            lat = restaurant.latlon[0]
            lon = restaurant.latlon[1]
            makeMap(lat, lon)
          } else {
            getCoordinates(restaurant.address)
          }          
        })
        .catch(function(error) {
          console.error("why is this happening?\n" + error);
        })
      }
      
      function getCoordinates(address) {
        fetch('https://nominatim.openstreetmap.org/search/?q='+ address +'&format=json')
        .then(function(response) {
          return response.json();
        })
        .then(function(geodata) {
          geodata = geodata[0]
          console.log(geodata)
          makeMap(geodata.lat, geodata.lon)
        })
        .catch(function(error) {
          console.error("why is this happening?\n" + error);
        })
      }
      
      function fillBody(restaurant) {
        content = document.getElementById('reviewContainer');
        content.innerHTML += "<h1>" + restaurant.name + "</h1><br>"
        content.innerHTML += "<h5>Address: " + restaurant.address + "</h5><br>"
        content.innerHTML += "<h5>Phone: " + restaurant['phone number'] + "</h5><br>"
        content.innerHTML += "<h5>Hours: " + restaurant.hours + "</h5><br>"
        content.innerHTML += '<p>Notes:</p><ul>'
          console.log(restaurant.notes)
          for (note of restaurant.notes) {
            console.log(note)
            content.innerHTML += "<li>" + note + "</li>"
          }
          content.innerHTML += '</ul>'
          
        }
      </script>
    </body>
  </HTML>
  